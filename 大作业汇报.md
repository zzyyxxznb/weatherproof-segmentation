# **后台管理系统大作业汇报**

### 1.**团队介绍与分工：**

我们的团队名称是CoJob，意为共同协作，团队成员共10人，由于网络上开源项目使用的springboot版本几乎都是2+版本，于是决定小组合作实现一个新的后台管理系统，从而能够符合课程作业的要求。

| 姓名   | 学号       | 分工                                   | 备注 |
| ------ | ---------- | -------------------------------------- | ---- |
| 陈佳辉 | SA24010007 | cojob logo设计，任务安排，主要开发人员 | 组长 |
| 陈曦   | SA24010086 | 后端部分接口实现                       |      |
| 唐一鸣 | SA24010045 | 后端部分接口实现                       |      |
| 范传进 | SA24010015 | 数据表字段设计                         |      |
| 张云翔 | SA24010065 | 数据表字段设计                         |      |
| 孙华杰 | SA24010043 | 前端设计与开发                         |      |
| 刘良生 | SA24010031 | 前端设计与开发                         |      |
| 梁鹭祺 | SA24010028 | 前端设计与开发                         |      |
| 文子建 | SA24010108 | 系统功能测试，问题检测                 |      |
| 王璐瑶 | SA24010049 | 系统功能测试，问题检测                 |      |

## **2. 项目背景**

- **课题来源**：高级数据库课程大作业

- **项目目标**：完成符合课程作业要求功能的后台管理系统

  ![img](img\作业要求.jpg)

------

## **3. 系统设计**

### **3.1 技术选型**

- **后端**：列出后端技术栈，例如 Spring Boot、MyBatis-Plus、Spring Security 等。
- **前端**：列出前端技术栈，例如 Vue、Element UI、Axios 等。
- **数据库**：描述使用的数据库及版本，例如 MySQL、Redis、MongoDB 等。
- **其他**：docker容器化技术，spring mail，jwt认证

### **3.2 系统架构**

系统整体架构图如图所示，采用的是前后端分离技术，使用的是SpringBoot3.0.2版本和JDK17，前端使用vue框架结合开源的Elument-UI组件帮助开发，后端采用Spring  Security实现安全登录功能，登陆之后生成jwt令牌存储在reids中，并通过过滤器校验用户是否携带令牌实现安全登陆访问功能，进行通过mybatis-plus持久化框架实现对mysql数据库的增删改查，使用Mongodb来进行通知信息的存储。![image-20241211100119814](img\版本.png)

```java
<properties>
        <java.version>17</java.version>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
<!--        SprintBoot版本是3.0.2-->
        <spring-boot.version>3.0.2</spring-boot.version>
    </properties>
```

![](img\架构图.png)



------

## **4. 核心功能**

### **4.1 登录注册**

限制使用科大邮箱登陆注册，在注册时，输入邮箱，然后会收到团队使用QQ邮箱发送的验证码，输入验证码和个人账号信息即可实现主策功能。密码使用md5加密存储，即使数据库被攻克也无法获得密码原文。

登陆时输入账号密码即可。

![image-20241211102057283](.\img\登录.png)

![image-20241211102155948](.\img\注册.png)

### **4.2 通知信息发布**

通知信息是文档型数据，其字段不好明确因此采用mongodb存储，支持通知信息发布，查看，评论等功能。

![image-20241211103046323](img\通知页.png)

------

### **4.3 部门信息查看**

支持学校，学院，教师三级分类信息查看，此数据与教师信息表关联，教师部门信息改动这里也会发生变化。

![image-20241211103234127](img\部门.png)

### 4.4 教师信息

支持教师信息查看，搜索，与编辑，并通过前后端协调，实现了分页查询功能。在编辑教师信息的时候实现了教师原有信息的嵌入，可以方便重复信息的输入。搜索功能根据教师姓名关键字查找，会查找出含有搜索字段教师的信息。



![image-20241211103540774](img\教师.png)

![image-20241211103750929](img\编辑教师.png)

### 4.5 学生信息

支持对学生信息的增删改查和关键词搜索，相比于教师信息处理大体类似，增加了添加和删除功能（出于教学管理权限考虑，没有设置有关于教师的增删功能实现），同样查询到的学生信息通过前后端协调实现了分页优化处理，方便查看。

![image-20241211104358294](img\学生信息.png)

### 4.6 课程信息

支持对课程信息的查看以及搜索和编辑,本着课程开课后仅允许上课老师和上课时间改变的原则，编辑课程信息时只允许这两个修改。

![image-20241211104837839](img\课程.png)

![image-20241211104949262](img\课程编辑.png)

### 4.7 教学日历

支持对本学期教学日历的查看，并在日历尾部设有教学日历下载功能

![image-20241211105251152](img\教学日历.png)

![image-20241211105424815](img\日历下载.png)

### 4.8 个人中心

支持账号发布内容查看与账号信息更改，包括头像更改上传，用户名更改，密码更改等。

![image-20241211105638542](img\我的发布.png)

![image-20241211105815437](img\账号信息.png)

## **5. 系统实现**

### **5.1 关键代码**

**登陆注册：**

```java
	@Override
    public String signup(SignupObj signupObj) {

        if(sysUserRepository.existsByEmail(signupObj.getEmail())){
            throw new EmailExistsException("邮箱账号已经存在");
        }

//        实现注册逻辑
        String email = signupObj.getEmail();
        if(!email.contains("@mail.ustc.edu.cn") && !email.contains("@ustc.edu.cn")){
            throw new EmailExistsException("请用科大邮箱注册");
        }

        QueryWrapper<Mail> queryWrapper = new QueryWrapper<>();
        queryWrapper.eq("mail", signupObj.getEmail());
        Mail mail = mailService.getOne(queryWrapper);
        //if(signupObj.getActCode() != mail.getCode()){ 字符串不能用等于
        if(!signupObj.getActCode() .equals(mail.getCode())){
            throw new EmailExistsException("验证码错误");
        }
        SysUser sysUser = new SysUser();
        sysUser.setEmail(signupObj.getEmail());
        sysUser.setPassword(passwordEncoder.encode(signupObj.getPassword()));
        sysUser.setNickName(signupObj.getNickName());
        sysUser.setSex(signupObj.getSex());
        sysUser.setIsDeleted((byte) 0);
        sysUser.setIsLocked((byte) 0);
        SysUser save = sysUserRepository.save(sysUser);
        return String.valueOf(save.getId());
    }

    @Override
    public LoginRes login(LoginObj loginObj) {
        // 创建Authentication对象
        UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(loginObj.getEmail() , loginObj.getPassword()) ;

        // 调用AuthenticationManager的authenticate方法进行认证,并没有捕获异常，spring自己抛出的
        Authentication authentication = authenticationManager.authenticate(authenticationToken);
        if(authentication == null) {
            throw new EmailOrPasswordErrorException("邮箱或密码错误");
        }

        // 将用户的数据存储到Redis中
        LoginUser loginUser = (LoginUser) authentication.getPrincipal();
        String userId = loginUser.getUser().getId().toString();
        String jsonString = JSON.toJSONString(loginUser);
        redisTemplate.boundValueOps("login_user:" + userId).set(jsonString);

        // 生成JWT令牌并进行返回
        LoginRes loginRes = new LoginRes();
        loginRes.setUserId(userId);
        String token = JwtUtils.getJwtToken(userId,loginUser.getUser().getEmail());
        loginRes.setToken(token);
        return loginRes;
    }
```

**通知发布：**

```
	@Override
    public String publish(PublishArticleObj publishArticleObj, String userId) {
        //如果是空的，返回null
        if (publishArticleObj == null){
            return null;
        }else{
            //如果不是空的，就存入数据库
            LittleTalk littleTalk = new LittleTalk();
            littleTalk.setType(publishArticleObj.getType());
            littleTalk.setForum(publishArticleObj.getForum());
            littleTalk.setTitle(publishArticleObj.getTitle());
            littleTalk.setContent(publishArticleObj.getContent());
            littleTalk.setImageIds(publishArticleObj.getImageIds());
            littleTalk.setTags(publishArticleObj.getTags());
            littleTalk.setCityTags(publishArticleObj.getCityTags());
            littleTalk.setCompanyTags(publishArticleObj.getCompanyTags());
            littleTalk.setJobTags(publishArticleObj.getJobTags());

            littleTalk.setUserId(Long.valueOf(userId));
            littleTalk.setUserIsLocked(false);
            littleTalk.setTimeOfCreation(LocalDateTime.now(ZoneId.of("Asia/Shanghai")));
            littleTalk.setIsDeleted(false);
            littleTalk.setNumberOfLikes(0);
            littleTalk.setNumberOfReports(0);

//          保存
            LittleTalk save = littleTalkRepository.save(littleTalk);
            return save.getId();

        }

    }
```

**评论发布：**

```java
@Override
public String commentPublish(Comment comment) {
    comment.setTime(LocalDateTime.now(ZoneId.of("Asia/Shanghai")));
    Comment save = commentRepository.save(comment);
    return save.getId();
}
```

**增删改查Controller层调用**

```java
/**
 * 列表
 */
@RequestMapping("/list")

public ResponseResult<PageUtils> list(@RequestParam Map<String, Object> params){

    PageUtils page = studentService.queryPage(params);
    return new ResponseResult<PageUtils>().setCode(200).setMsg("查询到学生数据").setData(page);

}

/**
 * 修改
 */
@RequestMapping("/update/{userid}")
//@RequiresPermissions("teach_ms:student:update")
public ResponseResult<String> update(@PathVariable String userid, @RequestBody Student student){
    studentService.updateById(student);
    return new ResponseResult<String>().setCode(200).setMsg("修改成功");

}

/**
 * 删除
 */
@RequestMapping("/delete/{id}")
//@RequiresPermissions("teach_ms:student:delete")
public ResponseResult<String> delete(@PathVariable("id") String id){
    if(studentService.removeById(id)) {
        return new ResponseResult<String>().setCode(200).setMsg("删除成功");
    }else{
        return new ResponseResult<String>().setCode(400).setMsg("删除失败");
    }
}

/**
 * 保存
 */
@RequestMapping("/add")
//@RequiresPermissions("teach_ms:student:save")
public ResponseResult<String> save(@RequestBody Student student){
    studentService.save(student);
    return new ResponseResult<String>().setCode(200).setMsg("添加成功");
}
```

**分页查询：**

```java
@Override
public PageUtils queryPage(Map<String, Object> params) {
    QueryWrapper<Student> queryWrapper = new QueryWrapper<>();
    if(params.get("search")!=null) {
        queryWrapper.like("userName", params.get("search"));
    }
    IPage<Student> page = this.page(
            new Query<Student>().getPage(params),
            queryWrapper
    );

    return new PageUtils(page);
}
```



### **5.2 数据库设计**

数据库设计主要集中于mysql在此，具体如下所示：

![image-20241211111328165](img\数据表.png)

**字段举例展示：**

**教师表字段**

![image-20241211111731856](img\教师表字段.png)

**用户信息含数据原表：**可以看到密码存储为一长串经过加密后的字符串

![image-20241211111958478](img\用户信息表.png)

**建表sql语句：**

```sql
SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for course
-- ----------------------------
DROP TABLE IF EXISTS `course`;
CREATE TABLE `course`  (
  `courseID` int NOT NULL,
  `courseName` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `time` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `teachID` int NOT NULL,
  PRIMARY KEY (`courseID`) USING BTREE,
  INDEX `teachID`(`teachID` ASC) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb3 COLLATE = utf8mb3_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Table structure for depratment
-- ----------------------------
DROP TABLE IF EXISTS `depratment`;
CREATE TABLE `depratment`  (
  `deptID` int NOT NULL,
  `deptName` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `stuName` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  PRIMARY KEY (`deptID`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb3 COLLATE = utf8mb3_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Table structure for mail
-- ----------------------------
DROP TABLE IF EXISTS `mail`;
CREATE TABLE `mail`  (
  `mail` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
  `code` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `send_time` time NULL DEFAULT NULL,
  PRIMARY KEY (`mail`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Table structure for student
-- ----------------------------
DROP TABLE IF EXISTS `student`;
CREATE TABLE `student`  (
  `userID` varchar(10) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL COMMENT '学号',
  `userName` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL COMMENT '姓名',
  `userSex` varchar(1) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL COMMENT '性别',
  `userage` int NOT NULL COMMENT '年龄',
  `classID` int NOT NULL COMMENT '班号',
  `teachID` int NULL DEFAULT NULL COMMENT '导师',
  PRIMARY KEY (`userID`) USING BTREE,
  INDEX `classID`(`classID` ASC) USING BTREE,
  INDEX `student_ibfk_2`(`teachID` ASC) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb3 COLLATE = utf8mb3_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Table structure for sys_user
-- ----------------------------
DROP TABLE IF EXISTS `sys_user`;
CREATE TABLE `sys_user`  (
  `id` int NOT NULL AUTO_INCREMENT,
  `email` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `nick_name` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `sex` bit(1) NULL DEFAULT NULL,
  `is_deleted` bit(1) NULL DEFAULT NULL,
  `is_locked` bit(1) NULL DEFAULT NULL,
  `signup_time` datetime NULL DEFAULT NULL,
  `user_activation_code` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 12 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Table structure for teacher
-- ----------------------------
DROP TABLE IF EXISTS `teacher`;
CREATE TABLE `teacher`  (
  `teachID` int NOT NULL,
  `teachName` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `teachSex` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `teachAge` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `degree` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `title` varchar(25) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NOT NULL,
  `department` varchar(255) CHARACTER SET utf8mb3 COLLATE utf8mb3_general_ci NULL DEFAULT NULL,
  PRIMARY KEY (`teachID`) USING BTREE,
  INDEX `teachID`(`teachID` ASC) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb3 COLLATE = utf8mb3_general_ci ROW_FORMAT = DYNAMIC;

SET FOREIGN_KEY_CHECKS = 1;

```



### **5.3 部署与运行**

项目已经完整部署运营在阿里云公网服务器上，可以通过ip直接访问，后端java程序是通过打包成jar包然后传到服务器上使用java -jar命令启动，前端代码使用node.js打包后传到服务器上，并编译一个启动文件用于设置前端访问端口等信息，这里采用的是80端口，是访问ip时默认访问的端口，因此可以在访问项目的时候免于输入端口号。

项目所依赖的数据库为了方便直接部署在阿里云服务器的docker上面，通过命令快速拉取镜像，实例化容器，可以简化数据库安装配置的流程。

项目访问地址：[CoJob项目-USTC高级计算机网络大作业](http://47.122.69.56/#/)。  Ctrl+鼠标左键点击访问，可以通过邮箱注册访问，也可以使用账号ustcer（密码同账号）访问。项目的健壮性比较差，请不要将ip公开到网络上，否则程序很容易遭到攻击崩溃。（曾遭受过挖矿攻击占用）

------

![image-20241211112939134](img\阿里云.png)

## 6. 项目总结

**要求完成度：**老师要求的使用springboot3.0以上和mybatis框架实现用户，角色，部门，菜单，安全的教学管理系统系统。

这里使用的是Spingboot3.0.2和mybatis-plus满足技术工具要求；使用sping-security，邮箱验证码，过滤器满足了系统安全性的要求；

并设计有部门表，用户表等表格，满足场景功能要求；最后在前端设置导航栏，满足菜单要求，基本实现了作业所要求的全部内容。

分析当前系统的不足之处及未来可能的优化方向。

**不足之处：**许多特殊情况校验没有做，容易在用户操作不当时报错，且表格之间的关联性不够强。

**收获：**对于java后端开发与vue前端开发有了一点过的熟练度，对于数据库课程教学内容Mysql的使用得到了实际的锻炼与提升。



